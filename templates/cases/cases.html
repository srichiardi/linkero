{% extends "base.html" %}

{% block title %}Cases console{% endblock %}

{% block content %}

<div class="row content">
	
	<div class="col-md-10"><!-- first column on the right -->
		<div class="row" id="filter">
			<div class="col-md-10">
				<!-- form goes here! -->
				<form role="form" id="case-filter-form" class="form-inline" action="" method="get">
					{% for field in case_filter_form %}
					<div class="form-group filter-form-group">
						{{ field.label_tag }}{{ field }}
					</div>
					{% endfor %}
					<button type="submit" class="btn btn-default">Filter</button>
				</form>
			</div>
		</div>
		<div class="row" id="cases-list-table">

		</div>

		
	</div><!-- closing first column -->
	<div class="col-md-2"><!-- second column on the left -->
		<div class="well">
			<div>
				<ul class="nav nav-list">
					<li><label class="tree-toggle nav-header">eBay</label>
						<ul class="nav nav-list tree">
							<li><a data-target="#ebay-listing-modal" data-toggle="modal" href="#ebay-listing-modal">Listings</a></li>
							<li><a href="#">Registration details</a></li>
						</ul>
					</li>
					<li class="divider"></li>
					<li><label class="tree-toggle nav-header">MercadoLibre</label>
						<ul class="nav nav-list tree">
							<li><a href="#">Listings</a></li>
							<li><a href="#">Registration details</a></li>
						</ul>
					</li>
					<li class="divider"></li>
					<li><label class="tree-toggle nav-header">Alegro</label>
						<ul class="nav nav-list tree">
							<li><a href="#">Listings</a></li>
							<li><a href="#">Registration details</a></li>
						</ul>
					</li>
					<li class="divider"></li>
					<li><label class="tree-toggle nav-header">Facebook</label>
						<ul class="nav nav-list tree">
							<li><a href="#">Places</a></li>
							<li><a href="#">Friends</a></li>
							<li><a href="#">Likes</a></li>
						</ul>
					</li>
				</ul>
			</div>
		</div><!-- closing well class -->
	</div><!-- closing second column -->
</div><!-- closing row content -->

<!-- Modals -->
{% include 'cases/ebay_modal_listings.html' %}
<!-- closing modals -->

{% endblock %}

{% block domready %}
<!-- BootStrap DatePicker JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.min.js"></script>

<script>
	$(".date-picker").datepicker({format: 'dd/mm/yyyy'});
	
	$('.tree-toggle').click(function () {
		$(this).parent().children('ul.tree').toggle(500);
	});
	
	$('.tree-toggle').parent().children('ul.tree').toggle(1000);
	
	// load the table function
	function get_cases() {
		var data = $('#case-filter-form').serialize();
		$.get(
				'{% url "cases" %}',
				data,
				function(response) {
					if (response['status'] == 'success') {
						// clean all table content
						$("#cases-list-table").empty();
						// populate the table with cases
						$("#cases-list-table").append(response["case_list"]);
					} else {
						// print error message in one single cell spanning all columns
					}
				}
		);
	};
	
	// GET cases request
	$('#case-filter-form').submit(function(event) {
		event.preventDefault();
		get_cases();
	});
	
	// post a case with ajax
	$('#ebay-listing-form').submit(function(event) {
		event.preventDefault();
		console.log("form submitted!");  // sanity check
		var data = $('#ebay-listing-form').serialize();
		$.post(
				'{% url "cases" %}',
				data,
				function(response){
					if (response['status'] == 'success') {
						// close modal
						// reload table
						get_cases();
					} else {
						// print error message in the modal
					};
				}
		);
	});
	
	// GET next page list of cases
	$('.pager').click(function (event) {
		event.preventDefault();
		var pageNr = $(this).attr("value");
		console.log(pageNr);
		$('#page-number').val(pageNr);
		//get_cases();		
	});
	
	$(document).ready(function() {
		get_cases();
	});
	
	
</script>
{% endblock %}
